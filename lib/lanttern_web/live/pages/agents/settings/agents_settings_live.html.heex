<Layouts.app_logged_in flash={@flash} current_user={@current_user} current_path={@current_path}>
  <.header_nav current_user={@current_user}>
    <:breadcrumb navigate={~p"/dashboard"}>
      {gettext("Dashboard")}
    </:breadcrumb>
    <:title>{gettext("AI Agents")}</:title>
  </.header_nav>
  <div class="p-4">
    <.responsive_container>
      <div class="flex items-center justify-between gap-4 p-4">
        <p class="flex items-center gap-2">
          <.icon name="hero-information-circle-mini" class="text-ltrn-subtle" />
          {gettext("Manage AI agents below")}
        </p>
        <.button
          type="button"
          phx-click="new_agent"
          icon_name="hero-plus-mini"
          theme="primary"
        >
          {gettext("New agent")}
        </.button>
      </div>
      <%= if @has_agents do %>
        <div class="p-4" id="agents-list" phx-update="stream">
          <.live_component
            :for={{dom_id, agent} <- @streams.agents}
            module={AgentCardComponent}
            id={dom_id}
            agent={agent}
            selected_agent_id={@selected_agent_id}
          />
        </div>
      <% else %>
        <div class="p-10">
          <.empty_state>{gettext("No agents created yet")}</.empty_state>
        </div>
      <% end %>
    </.responsive_container>
  </div>
  <.modal
    :if={@agent}
    id="agent-form-overlay"
    show={true}
    on_cancel={JS.push("close_agent_form")}
  >
    <:title>{@agent_overlay_title}</:title>
    <.live_component
      module={LantternWeb.Agents.AgentFormComponent}
      id="agent-form"
      agent={@agent}
      navigate={
        fn
          {:deleted, _agent} ->
            ~p"/settings/agents"

          {_created_or_updated, agent} ->
            ~p"/settings/agents/#{agent.id}"
        end
      }
      on_cancel={JS.exec("data-cancel", to: "#agent-form-overlay")}
    />
  </.modal>
</Layouts.app_logged_in>
